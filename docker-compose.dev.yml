services:
  # ==========================================
  # DATABASE SERVICES
  # ==========================================

  mysql:
    image: mysql:8.0
    container_name: mysql-db
    restart: unless-stopped
    env_file: .env
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
    ports:
      - "3307:3306" # External 3307 to avoid conflict
    volumes:
      - mysql-data:/var/lib/mysql
      - ./backend/src/main/resources/features.sql:/docker-entrypoint-initdb.d/features.sql
    networks:
      - app-network
    profiles: ["db"]

  # mongodb:
  #   image: mongo:7
  #   container_name: mongodb
  #   restart: unless-stopped
  #   env_file: .env
  #   environment:
  #     MONGO_INITDB_ROOT_USERNAME: ${MONGODB_USERNAME}
  #     MONGO_INITDB_ROOT_PASSWORD: ${MONGODB_PASSWORD}
  #     MONGO_INITDB_DATABASE: ${MONGODB_DATABASE}
  #   ports:
  #     - "27018:27017" # External 27018 to avoid conflict
  #   volumes:
  #     - mongo-data:/data/db
  #   networks:
  #     - app-network
  #   profiles: ["db"]

  # neo4j:
  #   image: neo4j:5
  #   container_name: neo4j
  #   restart: unless-stopped
  #   environment:
  #     NEO4J_AUTH: ${NEO4J_USERNAME}/${NEO4J_PASSWORD}
  #   ports:
  #     - "7474:7474" # HTTP
  #     - "7687:7687" # Bolt
  #   volumes:
  #     - neo4j-data:/data
  #   networks:
  #     - app-network
  #   profiles: ["db"]

  # ==========================================
  # APPLICATION SERVICES
  # ==========================================

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: backend
    restart: unless-stopped
    env_file: .env
    ports:
      - "8080:8080"
    # depends_on:
    #   - mysql
    #   - mongodb
    #   - neo4j
    networks:
      - app-network
    profiles: ["app"]

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_PROD_API_BASE_URL: ${VITE_PROD_API_BASE_URL:-http://localhost/api}
    container_name: frontend
    restart: unless-stopped
    networks:
      - app-network
    profiles: ["app"]

  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    container_name: nginx
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - frontend
      - backend
    networks:
      - app-network
    profiles: ["app"]

networks:
  app-network:
    driver: bridge

volumes:
  mysql-data:
  mongo-data:
  neo4j-data:
